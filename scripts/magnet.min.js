(function(e,t,n,r){function o(t,n){this.element=t;this.$element=t;this.settings=e.extend({},s,n);this._defaults=s;this._name=i;this.init()}var i="magnet",s={columns:{items:10},containerSelector:".magnet",containerStyle:{position:"relative",overflow:"hidden"},duration:800,filter:"*",filterSelector:".magnet-filter",gutter:null,hiddenClass:"magnet-hidden",hiddenStyle:{opacity:0,scale:0},itemSelector:".magnet-item",itemStyle:{position:"absolute"},layoutMode:"masonry",rows:{items:10},visibleStyle:{opacity:"1",scale:"1"}};o.prototype={init:function(){var t=this;t.$id=e("#"+t.element.id);t.$container=e(t.$id).find(t.settings.containerSelector);t.$item=e(t.$id).find(t.settings.itemSelector);t.containerWidth;t.items={i:[],w:[],h:[],x:[],y:[],v:[]};t.getContainerWidth();t.setStyles();t.fetchItems();t.filterItems();t.layoutItems();t.resizeContainer();t.onResize();t.onClick()},getContainerWidth:function(){var e=this,t=e.$container;e.containerWidth=t.width()},setStyles:function(){var e=this,t=e.$container,n=e.$item;t.css(e.settings.containerStyle);n.css(e.settings.itemStyle);n.css({"margin-right":e.settings.gutter+"px","margin-bottom":e.settings.gutter+"px"})},fetchItems:function(){var t=this,n=t.$item,r=0;n.each(function(){var n=e(this),i=n[0].getBoundingClientRect().width+(n.outerWidth(true)-n.outerWidth()),s=n.outerHeight(true);t.items.i.push(r);t.items.w.push(i);t.items.h.push(s);t.items.v.push(true);r++})},filterItems:function(){var t=this,n=t.$item,r=0;n.each(function(){var n=e(this),i=true;if(t.settings.filter==="*"||n.hasClass(t.settings.filter)){n.removeClass(t.settings.hiddenClass)}else{i=false;n.addClass(t.settings.hiddenClass)}t.items.v[r]=i;r++})},layoutItems:function(){var t=this,n=t.settings.layoutMode,r=t.items,i=t.$container,s=t.$item,o=0,u=1,a=1,f,l=0,c=t.items.h[0],h=0,p=0,d=0,v=true,m=false;if(n=="masonry"){s.each(function(){var n=e(this);if(r.v[o]){r.x[o]=p;r.y[o]=l;do{m=false;for(j=o-1;j>=0&&!m;j--){if(r.v[j]){condition_1=r.x[o]+r.w[o]>r.x[j]&&r.x[o]+r.w[o]<r.x[j]+r.w[j];condition_2=r.x[j]+r.w[j]>r.x[o]&&r.x[j]+r.w[j]<r.x[o]+r.w[o];condition_3=r.x[o]==r.x[j];condition_4=r.x[o]+r.w[o]==r.x[j]+r.w[j];condition_5=r.y[j]+r.h[j]>r.y[o];condition=(condition_1||condition_2||condition_3||condition_4)&&condition_5;if(condition){m=true;p=r.x[j];if(p+r.w[o]+r.w[j]<=t.containerWidth){p+=r.w[j]}else{p=0;l+=c}r.x[o]=p;r.y[o]=l}}}if(m){v=false}else{v=true}}while(!v);t.animateItems(n,p,l,true);if(r.h[o]<c){c=r.h[o]}f=o+1;while(r.v[f]==false){f++}if(p+r.w[o]+r.w[f]<=t.containerWidth){p+=r.w[o]}else{l+=c;p=0;c=r.h[f]}}else{t.animateItems(n,r.x[o],r.y[o],false)}o++})}else if(n=="tiled"){s.each(function(){var n=e(this);if(r.v[o]){r.x[o]=p;r.y[o]=l;for(j=o-1;j>=0;j--){if(r.v[j]){condition_1=r.x[o]+r.w[o]>r.x[j]&&r.x[o]+r.w[o]<r.x[j]+r.w[j];condition_2=r.x[j]+r.w[j]>r.x[o]&&r.x[j]+r.w[j]<r.x[o]+r.w[o];condition_3=r.x[o]==r.x[j];condition_4=r.x[o]+r.w[o]==r.x[j]+r.w[j];condition_5=r.y[j]+r.h[j]>r.y[o];condition=(condition_1||condition_2||condition_3||condition_4)&&condition_5;if(condition){if(p+r.w[o]>t.containerWidth){p=0}else{l=r.h[j]+r.y[j]}r.x[o]=p;r.y[o]=l}}}t.animateItems(n,p,l,true);if(l>h){l=h}if(r.h[o]<c){c=r.h[o]}f=o+1;while(r.v[f]==false){f++}if(p+r.w[o]+r.w[f]<=t.containerWidth){p+=r.w[o]}else{h+=c;p=0;l=h;c=r.h[f]}}else{t.animateItems(n,r.x[o],r.y[o],false)}o++})}else if(n=="rows"){s.each(function(){var n=e(this);if(r.v[o]){r.x[o]=p;r.y[o]=l;t.animateItems(n,p,l,true);if(r.h[o]>h){h=r.h[o]}f=o+1;while(r.v[f]==false){f++}if(p+r.w[o]+r.w[f]<=t.containerWidth&&u<t.settings.rows.items){p+=r.w[o]}else{l+=h;u=0;p=0;h=0}u++}else{t.animateItems(n,r.x[o],r.y[o],false)}o++})}else if(n=="columns"){s.each(function(){var n=e(this);if(r.v[o]){r.x[o]=p;r.y[o]=l;t.animateItems(n,p,l,true);if(r.w[o]>d){d=r.w[o]}f=o+1;while(r.v[f]==false){f++}if(a<t.settings.columns.items){l+=r.h[o]}else{p+=d;a=0;l=0;d=0}a++}else{t.animateItems(n,r.x[o],r.y[o],false)}o++})}else if(n=="vertical"){s.each(function(){var n=e(this);if(r.v[o]){r.x[o]=p;r.y[o]=l;t.animateItems(n,p,l,true);l+=r.h[o]}else{t.animateItems(n,r.x[o],r.y[o],false)}o++})}else if(n=="horizontal"){s.each(function(){var n=e(this);if(r.v[o]){r.x[o]=p;r.y[o]=l;t.animateItems(n,p,l,true);p+=r.w[o]}else{t.animateItems(n,r.x[o],r.y[o],false)}o++})}else{n="masonry";t.layoutItems()}},animateItems:function(e,t,n,r){var i=this;if(r){opacity=i.settings.visibleStyle.opacity;scale=i.settings.visibleStyle.scale}else{opacity=i.settings.hiddenStyle.opacity;scale=i.settings.hiddenStyle.scale}e.css({transform:"translate3d("+t+"px,"+n+"px, 0px) scale3d("+scale+", "+scale+", "+scale+")",opacity:opacity,transition:i.settings.duration+"ms"})},resizeContainer:function(){var e=this,t=e.settings.layoutMode,n=e.items,r=e.$container,i=e.$item,s=0,o=0,u=0;if(t=="columns"||t=="horizontal"){for(s=0;s<n.v.length;s++){if(n.v[s]){if(n.w[s]+n.x[s]>o){o=n.w[s]+n.x[s]}}}o+=r.outerWidth()-e.containerWidth;r.css("width",o)}for(s=0;s<n.v.length;s++){if(n.v[s]){if(n.h[s]+n.y[s]>u){u=n.h[s]+n.y[s]}}}u+=r.outerHeight()-r.height();r.css({height:u,transition:e.settings.duration+"ms"})},onClick:function(){var t=this,n=e(t.$id).find(t.settings.filterSelector);n.on("click","[data-filter]",function(){var r=e(this);if(r.parent().is(n)){r.addClass("active").siblings().removeClass("active")}else{r.parent().addClass("active").siblings().removeClass("active")}t.settings.filter=r.attr("data-filter");t.getContainerWidth();t.filterItems();t.layoutItems();t.resizeContainer()})},onResize:function(){var n=this;e(t).resize(function(){n.getContainerWidth();n.layoutItems();n.resizeContainer()})}};e.fn[i]=function(t){this.each(function(){if(!e.data(this,"plugin_"+i)){e.data(this,"plugin_"+i,new o(this,t))}});return this}})(jQuery,window,document)